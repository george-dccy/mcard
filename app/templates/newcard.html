{% extends "base.html" %}
{% import "bootstrap/wtf.html" as wtf %}

{% block title %}开卡{% endblock %}

{% block page_content %}
<div class="page-header">
    <h1>新卡</h1>
</div>
<div class="col-md-5">
    {{ wtf.quick_form(form) }}
</div>
{% endblock %}

{% block scripts %}
{{ super() }}
<script language="javascript" type="text/javascript">
    $(function(){
        var SCRIPT_ROOT = {{request.script_root|tojson|safe}};
        $('input[name="cardnumber"]').bind('keyup', function(){
            $.getJSON(SCRIPT_ROOT + '/newcard_remaining',{
                cardnumber: $('input[name="cardnumber"]').val()
            },
            function(data){
                $('input[name="remaining"]').val(data.result);
            }
            );
        })
    });
    function CheckIsInstall() {
		try{
		    var LODOP=getLodop();
			if (LODOP.VERSION) {
				};
		 }catch(err){
            var btn = document.getElementById("submit");
            btn.disabled=true;
 		 }
	};
    $(document).ready(function(){
        $("#cardnumber").focus();
    });

    $(function(){
        var SCRIPT_ROOT = {{request.script_root|tojson|safe}};
        $('input[name="cardnumber"]').bind('change', function(){
            $.getJSON(SCRIPT_ROOT + '/card_check_validate',{
                cardnumber: $('input[name="cardnumber"]').val()
            },
            function(data){
                if ($('form').find('span')) {
                    $('form').find('span').remove()
                }
                var r=$("<span></span>").addClass(data.text_class).text(data.result);
                $('input[name="cardnumber"]').parent().append(r);
            }
            );
        })
    });

    window.onload=CheckIsInstall;
</script>
{% endblock %}